import React from "react";

import Card from "@material-ui/core/Card";
import CardHeader from "@material-ui/core/CardActions";
import CardContent from "@material-ui/core/CardContent";
import CardMedia from "@material-ui/core/CardMedia";
import CardActions from "@material-ui/core/CardActions";
import Typography from "@material-ui/core/Typography";
import Container from "@material-ui/core/Container";

import Button from "@material-ui/core/Button";
import { Link } from "react-router-dom";

class Ajax {
  constructor(props) {
    this.props = props;
    this.state = {
      url: props.url,
      csrf: this.getCSRFtoken()
    };
    this.submit = this.submit.bind(this);
    this.cnt = 0;
  }
  getCSRFtoken() {
    for (let c of document.cookie.split(";")) {
      let cArray = c.split("=");
      if (cArray[0].replace(" ", "") === "csrftoken") return cArray[1];
    }
  }

  submit(data, view, callback) {
    if (this.props.debug) {
      this.cnt++;
      callback({
        success: true,
        results: [
          [
            [444.64839935302734, 273.73329162597656],
            [441.51195526123047, 247.6361846923828],
            [444.0788269042969, 253.66925239562988],
            [439.5261764526367, 221.0508155822754],
            [441.6157531738281, 240.36489486694336],
            [443.2517623901367, 229.89556789398193],
            [448.7791442871094, 202.60042190551758],
            [406.51344299316406, 190.32431602478027],
            [451.2703323364258, 181.0463047027588],
            [451.68628692626953, 170.82378387451172],
            [455.5554962158203, 133.61821174621582],
            [444.4864273071289, 276.4156150817871],
            [444.5911407470703, 278.97199630737305],
            [444.9638366699219, 280.66680908203125],
            [445.1728820800781, 280.8149528503418],
            [444.63794708251953, 285.0370788574219],
            [444.12559509277344, 290.10772705078125],
            [443.9112091064453, 295.0147819519043],
            [444.2733383178711, 297.67398834228516],
            [442.21763610839844, 250.9265899658203],
            [436.98150634765625, 249.51979637145996],
            [392.27073669433594, 157.296724319458],
            [424.05296325683594, 199.75463390350342],
            [417.52696990966797, 199.26770210266113],
            [411.35013580322266, 198.30408096313477],
            [404.2242431640625, 192.77599811553955],
            [429.4999694824219, 199.35410499572754],
            [415.9215545654297, 176.9941520690918],
            [423.55308532714844, 179.32093620300293],
            [408.8840103149414, 177.04280376434326],
            [404.4233703613281, 179.4216012954712],
            [398.9902114868164, 197.56206035614014],
            [423.1979751586914, 300.6008720397949],
            [404.67395782470703, 187.98036575317383],
            [389.03934478759766, 188.81695747375488],
            [394.3650436401367, 191.0295867919922],
            [416.7243194580078, 233.6043119430542],
            [436.74583435058594, 270.51990509033203],
            [437.67330169677734, 277.3429012298584],
            [429.6424102783203, 271.2362766265869],
            [424.9174499511719, 272.79035568237305],
            [432.08141326904297, 276.3489818572998],
            [427.69763946533203, 276.03209495544434],
            [418.3948516845703, 279.906005859375],
            [436.1463165283203, 246.62524223327637],
            [435.1760482788086, 239.62892532348633],
            [397.39192962646484, 170.65618515014648],
            [430.9840393066406, 215.64341068267822],
            [425.11165618896484, 241.4743709564209],
            [425.67115783691406, 237.04620838165283],
            [400.12237548828125, 229.34085845947266],
            [437.1478271484375, 229.85125064849854],
            [410.0178909301758, 164.47694778442383],
            [402.2637176513672, 165.75871467590332],
            [396.08524322509766, 146.18871688842773],
            [437.0343017578125, 175.85606575012207],
            [429.79278564453125, 183.73723983764648],
            [414.3061065673828, 272.7249526977539],
            [399.8932647705078, 253.46471786499023],
            [429.7433853149414, 246.23113632202148],
            [434.1653060913086, 249.16929244995117],
            [418.9382553100586, 276.1497688293457],
            [420.5864715576172, 276.35436058044434],
            [400.43190002441406, 160.60040473937988],
            [425.58361053466797, 244.29282188415527],
            [421.08863830566406, 167.04298496246338],
            [420.4177474975586, 160.8866786956787],
            [417.0701217651367, 133.76575469970703],
            [397.06546783447266, 155.27904510498047],
            [418.17588806152344, 149.3584156036377],
            [395.3742218017578, 167.0718240737915],
            [392.8343963623047, 163.8680934906006],
            [436.9041442871094, 274.35547828674316],
            [430.76271057128906, 274.02889251708984],
            [426.15856170654297, 274.46983337402344],
            [431.1809539794922, 247.6856517791748],
            [419.76593017578125, 276.2717056274414],
            [422.4016571044922, 278.53099822998047],
            [421.47144317626953, 276.46093368530273],
            [431.27532958984375, 244.7768783569336],
            [429.0428924560547, 277.18634605407715],
            [433.34339141845703, 277.9310989379883],
            [438.6377716064453, 279.1896343231201],
            [436.14078521728516, 295.8903121948242],
            [435.41324615478516, 292.87342071533203],
            [436.1024856567383, 288.0451011657715],
            [437.3622512817383, 283.0893802642822],
            [438.8182067871094, 279.3357467651367],
            [429.13665771484375, 277.2942638397217],
            [427.33455657958984, 278.981294631958],
            [425.4063415527344, 281.1814498901367],
            [423.86829376220703, 283.6284828186035],
            [420.1241683959961, 262.02077865600586],
            [394.1431427001953, 217.10529327392578],
            [443.07647705078125, 252.23899841308594],
            [425.74466705322266, 276.8669128417969],
            [424.03160095214844, 277.66161918640137],
            [436.0899353027344, 252.27696418762207],
            [428.00357818603516, 248.6092758178711],
            [435.1335144042969, 250.77043533325195],
            [424.5923614501953, 219.04791355133057],
            [413.9005661010742, 222.98888683319092],
            [425.21873474121094, 239.85498905181885],
            [403.5135269165039, 138.10343742370605],
            [404.9302673339844, 150.1159143447876],
            [408.69407653808594, 158.43923091888428],
            [422.7798843383789, 285.5965805053711],
            [435.5087661743164, 165.59738159179688],
            [433.8813018798828, 150.7726764678955],
            [433.8930130004883, 132.49757766723633],
            [406.56368255615234, 196.0472059249878],
            [392.4147033691406, 202.28023052215576],
            [433.0059814453125, 198.34537982940674],
            [399.3321228027344, 181.67953491210938],
            [435.1188659667969, 211.5868091583252],
            [427.4833297729492, 239.72331047058105],
            [389.2547607421875, 205.6236219406128],
            [394.4626235961914, 208.32881927490234],
            [401.1113739013672, 212.53940105438232],
            [413.45970153808594, 213.00365924835205],
            [422.9750061035156, 211.17785453796387],
            [429.8891830444336, 208.9112091064453],
            [442.6411437988281, 203.5369348526001],
            [389.7243118286133, 221.6558074951172],
            [395.6413269042969, 180.0366497039795],
            [438.9132308959961, 250.2458667755127],
            [430.37227630615234, 224.05622005462646],
            [391.49547576904297, 185.46677112579346],
            [435.0053405761719, 205.87470531463623],
            [425.7286071777344, 239.57300662994385],
            [402.31956481933594, 187.72055625915527],
            [428.4934997558594, 234.3826389312744],
            [396.3455581665039, 234.585599899292],
            [433.42830657958984, 195.74606895446777],
            [432.37476348876953, 231.28429412841797],
            [404.62451934814453, 277.35803604125977],
            [407.7951431274414, 282.6518440246582],
            [389.1490936279297, 219.31973934173584],
            [399.52999114990234, 265.59946060180664],
            [390.7025146484375, 175.22286415100098],
            [422.8829574584961, 305.8255863189697],
            [440.33016204833984, 251.5964698791504],
            [424.9079895019531, 228.64532947540283],
            [390.83099365234375, 191.89023971557617],
            [412.1337890625, 193.49388599395752],
            [417.59273529052734, 194.75875854492188],
            [420.9899139404297, 279.5571041107178],
            [392.02369689941406, 235.93175411224365],
            [433.8639831542969, 316.8193817138672],
            [419.5397186279297, 302.3943614959717],
            [414.22523498535156, 294.0705871582031],
            [453.24737548828125, 152.64573097229004],
            [446.5382766723633, 320.6957530975342],
            [423.1616973876953, 195.3332805633545],
            [428.4005355834961, 195.5360984802246],
            [431.768798828125, 195.8344602584839],
            [393.089599609375, 178.26866626739502],
            [428.3730697631836, 190.09660720825195],
            [422.8842544555664, 187.16847896575928],
            [416.92039489746094, 185.63246726989746],
            [411.14749908447266, 185.50592422485352],
            [407.74059295654297, 186.43415451049805],
            [390.5933380126953, 169.69812870025635],
            [408.7188720703125, 191.9673728942871],
            [444.12036895751953, 259.61915016174316],
            [425.28839111328125, 259.1268825531006],
            [429.36187744140625, 245.19478797912598],
            [435.42564392089844, 258.92744064331055],
            [450.73158264160156, 191.41289234161377],
            [410.7075881958008, 288.0640411376953],
            [416.64920806884766, 296.7036724090576],
            [431.96136474609375, 313.5835647583008],
            [403.5911560058594, 269.83165740966797],
            [431.84391021728516, 193.55556964874268],
            [437.05211639404297, 215.74267387390137],
            [445.0907897949219, 317.462797164917],
            [425.5298614501953, 310.3816223144531],
            [391.6904067993164, 235.12720584869385],
            [433.48968505859375, 278.075008392334],
            [431.6133117675781, 280.9244441986084],
            [429.9186706542969, 284.54752922058105],
            [428.7016296386719, 288.74768257141113],
            [428.4629440307617, 291.20272636413574],
            [424.07012939453125, 276.0567855834961],
            [422.5564956665039, 275.24574279785156],
            [421.38431549072266, 274.3509006500244],
            [416.33140563964844, 266.85479164123535],
            [397.4894714355469, 243.1227207183838],
            [438.9451599121094, 207.0718002319336],
            [438.08074951171875, 190.3824806213379],
            [434.61631774902344, 190.9032154083252],
            [425.69190979003906, 276.8246555328369],
            [399.0034866333008, 258.5896682739258],
            [442.39784240722656, 190.9566879272461],
            [425.79994201660156, 295.59276580810547],
            [445.16632080078125, 220.71428775787354],
            [440.8647918701172, 212.80159950256348],
            [446.9245910644531, 212.07326889038086],
            [431.9843292236328, 227.2787618637085],
            [444.46136474609375, 311.7535972595215],
            [444.40357208251953, 304.3040370941162],
            [434.3098831176758, 301.6823101043701],
            [413.41224670410156, 280.3886890411377],
            [420.2241516113281, 244.52653884887695],
            [419.0736389160156, 288.5845756530762],
            [407.3463821411133, 240.8679485321045],
            [414.59503173828125, 251.04097366333008],
            [403.44146728515625, 251.18316650390625],
            [432.161865234375, 308.32860946655273],
            [429.2964172363281, 230.59580326080322],
            [410.0590515136719, 282.9612636566162],
            [416.70814514160156, 291.8986415863037],
            [408.9328384399414, 271.23252868652344],
            [394.7871398925781, 247.87897109985352],
            [403.84105682373047, 269.12896156311035],
            [394.9833679199219, 250.2436351776123],
            [410.62015533447266, 259.7211170196533],
            [433.86199951171875, 219.7461175918579],
            [429.1480255126953, 243.3493709564209],
            [426.7303466796875, 244.26263809204102],
            [430.74047088623047, 239.25464630126953],
            [433.13602447509766, 181.62514686584473],
            [422.5831985473633, 174.7572898864746],
            [413.1058120727539, 172.3524284362793],
            [405.6589126586914, 172.74044036865234],
            [401.06956481933594, 175.66718101501465],
            [398.91849517822266, 189.2552947998047],
            [388.10386657714844, 203.86108875274658],
            [401.30767822265625, 201.29322052001953],
            [407.10350036621094, 204.63312149047852],
            [415.6290817260742, 205.62755584716797],
            [423.9632797241211, 205.08431911468506],
            [430.3249740600586, 203.9183235168457],
            [434.65431213378906, 202.43977546691895],
            [393.1438446044922, 201.00608825683594],
            [427.3927688598633, 245.96972465515137],
            [435.2149963378906, 223.42065811157227],
            [432.25635528564453, 244.73115921020508],
            [436.15482330322266, 248.4034252166748],
            [433.09574127197266, 245.6414794921875],
            [429.29821014404297, 248.20773124694824],
            [437.0594024658203, 249.44171905517578],
            [438.3639144897461, 250.83412170410156],
            [435.4595184326172, 196.43145561218262],
            [438.2819366455078, 198.85057926177979],
            [439.2390441894531, 200.61757564544678],
            [405.8890151977539, 187.2847080230713],
            [402.0261764526367, 182.6195240020752],
            [451.6409683227539, 222.28591918945312],
            [505.3635025024414, 199.72935676574707],
            [450.5032730102539, 251.27992630004883],
            [546.7042541503906, 169.5635175704956],
            [483.7019729614258, 203.96570205688477],
            [490.7965850830078, 205.29301643371582],
            [498.2581329345703, 206.06057167053223],
            [509.3091583251953, 202.57325649261475],
            [477.8289031982422, 202.02086448669434],
            [497.1612548828125, 183.85937690734863],
            [488.5941696166992, 183.91807079315186],
            [505.09620666503906, 185.83894729614258],
            [510.20801544189453, 189.34978008270264],
            [516.3896942138672, 208.18925857543945],
            [472.2061538696289, 308.1942558288574],
            [509.0744400024414, 198.03943634033203],
            [546.2833786010742, 203.42112064361572],
            [526.8969345092773, 202.37136840820312],
            [485.30078887939453, 241.29778861999512],
            [453.62972259521484, 272.7964496612549],
            [452.6398468017578, 279.3753147125244],
            [462.54425048828125, 275.9973335266113],
            [468.8182067871094, 278.99133682250977],
            [459.97493743896484, 280.2322769165039],
            [466.0602569580078, 281.3462448120117],
            [478.55892181396484, 288.37878227233887],
            [447.63916015625, 248.08382034301758],
            [448.8917922973633, 241.15562438964844],
            [521.8695831298828, 182.32352256774902],
            [472.5807189941406, 219.922513961792],
            [467.86922454833984, 246.7430877685547],
            [469.54273223876953, 242.24329948425293],
            [509.0234375, 241.4904499053955],
            [450.1957321166992, 231.1802101135254],
            [502.5598907470703, 172.44632720947266],
            [513.6995697021484, 176.07158660888672],
            [536.9886779785156, 156.64172172546387],
            [467.96215057373047, 177.93355464935303],
            [481.0582733154297, 186.57212734222412],
            [483.91712188720703, 282.1607494354248],
            [533.7337493896484, 269.36737060546875],
            [462.049560546875, 250.44187545776367],
            [456.1994934082031, 251.9428539276123],
            [477.40234375, 283.78063201904297],
            [475.6049346923828, 283.61992835998535],
            [518.7911224365234, 170.7088279724121],
            [468.56292724609375, 249.69297409057617],
            [487.7865982055664, 172.31919765472412],
            [489.2325973510742, 165.84912300109863],
            [501.0302734375, 139.36865329742432],
            [527.9490661621094, 165.26412963867188],
            [493.91040802001953, 154.45067882537842],
            [527.9270172119141, 178.3494758605957],
            [537.5268173217773, 175.7969570159912],
            [453.1543731689453, 276.5155792236328],
            [461.1935806274414, 278.3181381225586],
            [467.44407653808594, 280.2146530151367],
            [460.43201446533203, 251.52013778686523],
            [476.4820098876953, 283.7203788757324],
            [472.68409729003906, 285.3416347503662],
            [474.6236038208008, 283.5068893432617],
            [457.4669647216797, 248.1236743927002],
            [465.1133346557617, 282.1072769165039],
            [459.0956115722656, 281.4280128479004],
            [452.330322265625, 281.05791091918945],
            [453.9488983154297, 298.54371070861816],
            [453.3042526245117, 295.68583488464355],
            [453.0962371826172, 290.58783531188965],
            [452.8737258911133, 285.31628608703613],
            [452.5419235229492, 281.2378120422363],
            [465.2305603027344, 282.3087215423584],
            [466.6000747680664, 284.4612693786621],
            [468.07483673095703, 287.2729969024658],
            [469.25743103027344, 290.23221015930176],
            [474.7478485107422, 269.1650390625],
            [547.8774642944336, 232.9158067703247],
            [469.7968292236328, 282.8635883331299],
            [471.16992950439453, 284.0413284301758],
            [453.6136245727539, 254.50152397155762],
            [466.23069763183594, 253.55169296264648],
            [454.8636245727539, 253.26799392700195],
            [480.0918197631836, 224.88956451416016],
            [491.7760467529297, 231.40650272369385],
            [471.00215911865234, 245.4115104675293],
            [522.3408508300781, 146.3441562652588],
            [514.007453918457, 157.80133724212646],
            [505.8075714111328, 166.1056423187256],
            [471.85237884521484, 292.74221420288086],
            [470.60657501220703, 167.3375415802002],
            [474.2865753173828, 153.6022138595581],
            [479.53739166259766, 135.53461074829102],
            [504.9887466430664, 205.2022647857666],
            [525.1357650756836, 214.2410373687744],
            [474.07276153564453, 200.1980495452881],
            [518.2218551635742, 192.74725914001465],
            [467.3204803466797, 214.78832244873047],
            [462.68871307373047, 243.91376495361328],
            [534.4894409179688, 220.41491031646729],
            [518.3889007568359, 220.2508020401001],
            [507.2499084472656, 223.1063461303711],
            [491.9353485107422, 220.6138801574707],
            [481.3786315917969, 216.3854169845581],
            [473.8578796386719, 212.55682468414307],
            [456.1204528808594, 204.76050853729248],
            [530.5592346191406, 236.95261001586914],
            [525.3707122802734, 191.54500007629395],
            [445.94715118408203, 251.16677284240723],
            [470.32360076904297, 228.3220911026001],
            [553.2987976074219, 199.91058826446533],
            [468.04359436035156, 208.47865104675293],
            [472.5775146484375, 245.23475646972656],
            [513.1486129760742, 198.0607795715332],
            [464.39395904541016, 238.4687376022339],
            [542.4250793457031, 250.79930305480957],
            [475.08182525634766, 197.58921146392822],
            [457.4522018432617, 234.0199899673462],
            [508.1264114379883, 291.2618064880371],
            [510.11478424072266, 296.4005470275879],
            [542.1719360351562, 235.51161289215088],
            [519.7086334228516, 280.6674385070801],
            [542.6762390136719, 188.4757661819458],
            [474.05609130859375, 313.93933296203613],
            [446.0409927368164, 252.2834873199463],
            [476.8858337402344, 234.38590049743652],
            [534.4854736328125, 203.55554580688477],
            [497.0393371582031, 201.07097625732422],
            [490.8788299560547, 200.64697265625],
            [474.091796875, 286.74302101135254],
            [527.2003555297852, 251.31500244140625],
            [461.370849609375, 321.25110626220703],
            [485.4210662841797, 312.4574089050293],
            [496.55921936035156, 306.1125183105469],
            [485.2791976928711, 199.50835704803467],
            [479.9676513671875, 198.25218200683594],
            [476.5471649169922, 197.84153938293457],
            [532.3677444458008, 189.25902843475342],
            [482.3792266845703, 193.44549179077148],
            [489.0886688232422, 192.16880321502686],
            [495.28003692626953, 192.5880002975464],
            [501.2169647216797, 194.06717777252197],
            [504.92870330810547, 195.7904577255249],
            [551.7997741699219, 183.20308685302734],
            [501.6306686401367, 200.6238842010498],
            [467.8413391113281, 264.61318016052246],
            [461.6403579711914, 249.3984603881836],
            [453.8434600830078, 261.33753776550293],
            [496.75647735595703, 300.616979598999],
            [485.8069610595703, 307.3175525665283],
            [460.39451599121094, 318.17928314208984],
            [522.3929595947266, 284.7484588623047],
            [477.4329376220703, 195.97735404968262],
            [459.8097229003906, 218.01074981689453],
            [473.8153076171875, 317.98839569091797],
            [537.2964477539062, 251.49418830871582],
            [459.2909240722656, 281.68161392211914],
            [460.3964614868164, 285.0486373901367],
            [461.35986328125, 289.23205375671387],
            [462.0048141479492, 293.8832187652588],
            [463.75205993652344, 296.39842987060547],
            [471.12892150878906, 282.39063262939453],
            [472.548828125, 281.95881843566895],
            [473.8093948364258, 281.41608238220215],
            [480.21812438964844, 275.32164573669434],
            [513.9315032958984, 256.6727828979492],
            [461.68731689453125, 209.24838066101074],
            [468.8115692138672, 191.4602565765381],
            [474.05994415283203, 192.51123905181885],
            [469.7323226928711, 282.78173446655273],
            [514.5286178588867, 272.70252227783203],
            [460.6494140625, 191.7323398590088],
            [468.4638214111328, 302.07152366638184],
            [453.92852783203125, 214.06662940979004],
            [464.0729522705078, 230.7931137084961],
            [456.41143798828125, 305.073938369751],
            [486.46419525146484, 290.6747245788574],
            [478.6194610595703, 251.4624309539795],
            [478.4185028076172, 297.33020782470703],
            [496.0597229003906, 251.1394500732422],
            [484.5271301269531, 259.48262214660645],
            [501.81156158447266, 263.00963401794434],
            [458.81591796875, 312.52933502197266],
            [468.9895248413086, 235.01317977905273],
            [493.6248016357422, 294.8526191711426],
            [483.06522369384766, 301.8453884124756],
            [492.42725372314453, 282.3753547668457],
            [523.9007568359375, 263.0878257751465],
            [503.1382751464844, 282.04708099365234],
            [530.8350372314453, 266.3265609741211],
            [489.4518280029297, 269.5865821838379],
            [465.10379791259766, 223.0125617980957],
            [459.66766357421875, 247.205228805542],
            [464.99576568603516, 249.1402816772461],
            [456.13555908203125, 242.26035118103027],
            [475.2609634399414, 184.15579319000244],
            [487.93575286865234, 179.94935989379883],
            [498.9845657348633, 179.82441902160645],
            [508.28125, 182.1690845489502],
            [514.8329925537109, 186.3876485824585],
            [519.0425491333008, 200.19494533538818],
            [545.4618072509766, 219.50048446655273],
            [511.1654281616211, 211.56994342803955],
            [502.4930953979492, 213.46740245819092],
            [491.81312561035156, 212.2840118408203],
            [482.5166702270508, 209.56993103027344],
            [475.63133239746094, 206.84404850006104],
            [470.8007049560547, 204.42871570587158],
            [551.3286590576172, 216.05202198028564],
            [465.2712631225586, 250.83166122436523],
            [458.05492401123047, 225.80726623535156],
            [453.58802795410156, 247.47422218322754],
            [450.4569625854492, 250.41675567626953],
            [454.1875457763672, 248.4792995452881],
            [463.48731994628906, 252.6173973083496],
            [448.50982666015625, 250.98258018493652],
            [448.5660171508789, 252.13434219360352],
            [471.9028854370117, 197.81367301940918],
            [467.1105194091797, 200.0415802001953],
            [463.68709564208984, 202.19056606292725],
            [507.2594451904297, 197.08564281463623],
            [513.4610366821289, 193.145170211792],
            [420.84598541259766, 190.19225120544434],
            [427.78175354003906, 191.40300750732422],
            [421.72542572021484, 184.32332038879395],
            [413.85780334472656, 189.03943061828613],
            [419.9021911621094, 196.10079288482666],
            [495.18932342529297, 195.54349422454834],
            [502.6732635498047, 196.35615348815918],
            [496.10424041748047, 188.83491039276123],
            [487.76302337646484, 194.61620807647705],
            [494.3780517578125, 202.250018119812]
          ]
        ],
        modal_open: true,
        modal_description:
          this.cnt === 100 ? "顔画像の登録に成功しました" : "test_description",
        end: this.cnt === 100,
        modal_title: "test",
        progress: this.cnt,
        isLoad: true
      });
    } else {
      fetch(this.state.url + view, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-CSRFToken": this.state.csrf // CSRFトークン
        },
        body: JSON.stringify(data)
      })
        .then((res) => res.json())
        .then((res) => {
          console.log(res);
          callback(res);
        });
    }
  }
}

class WebcamCapture extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      question: "画面を向いてください",
      content: "check",
      item: 0,
      modal_open: false,
      modal_description: "",
      modal_title: "",
      face_width: 0,
      face_height: 0
    };

    this.ajax = new Ajax(props);
    this.capture = this.capture.bind(this);
    this.router = this.router.bind(this);
    this.submit = this.submit.bind(this);
    this.imageView = this.imageView.bind(this);

    this.start = this.start.bind(this);
    this.end = this.end.bind(this);
  }
  start() {
    const data = JSON.parse(JSON.stringify(this.state));
    data.content = this.props.content;
    data.item = this.state.item ? this.state.item : 0;
    this.ajax.submit(
      data,
      this.props.app + "/init/" + this.props.content + "/",
      this.router
    );
  }
  end() {
    const data = JSON.parse(JSON.stringify(this.state));
    data.content = this.props.content;
    data.item = this.state.item ? this.state.item : 0;
    this.ajax.submit(
      data,
      this.props.app + "/end/" + this.state.content + "/",
      () => {}
    );
  }
  componentDidMount() {
    const face_canvas = document.createElement("canvas");
    const face_context = face_canvas.getContext("2d");
    const video = document.createElement("video");
    if (navigator.mediaDevices) {
      navigator.mediaDevices
        .getUserMedia({ video: true, audio: false })
        .then((stream) => {
          video.srcObject = stream;
          video.play();
          video.onloadedmetadata = (e) => {
            // this.submit();

            face_canvas.width = video.videoWidth;
            face_canvas.height = video.videoHeight;
            //////////////////////////////////////////////////
            this.setState({
              capture: false,
              video: video,
              face_canvas: face_canvas,
              face_context: face_context,
              face_width: video.videoWidth,
              face_height: video.videoHeight,
              content_time: 0,
              item_time: 0
            });
            this.start();
            //////////////////////////////////////////////////
          };
        })
        .catch(function (error) {
          console.error(error);
          return;
        });
    }
  }
  capture() {
    this.state.face_context.drawImage(
      this.state.video,
      0,
      0,
      this.state.face_width,
      this.state.face_height
    );
    return this.state.face_canvas.toDataURL();
  }
  submit() {
    const data = JSON.parse(JSON.stringify(this.state));

    data.face_image = this.capture();

    this.ajax.submit(
      data,
      this.props.app + "/" + this.props.view + "/",
      this.router
    );
  }
  imageView(props) {
    const img = new Image();
    img.src = this.capture();
    img.onload = () => {
      const face_canvas = document.getElementById("result");
      if (face_canvas) {
        const face_context = face_canvas.getContext("2d");
        face_context.drawImage(
          img,
          0,
          0,
          this.state.face_width,
          this.state.face_height
        ); //
        if (props.success) {
          props.results.forEach((landmarks, i) => {
            landmarks.forEach((xyz, j) => {
              face_context.beginPath();
              face_context.arc(
                xyz[0],
                xyz[1],
                1,
                (0 * Math.PI) / 180,
                (360 * Math.PI) / 180,
                false
              );
              face_context.fillStyle = "red";
              face_context.fill();
            });
          });
        }
      }
    };
  }

  router(props) {
    this.imageView(props);

    if (document.getElementById("result"))
      // TODO: Improve
      this.settimeout = setTimeout(this.submit, 100);
  }

  render() {
    return (
      <Container maxWidth={this.props.tablet ? false : "md"}>
        <Card>
          <CardHeader>
            <Typography variant="h3">環境の確認</Typography>
          </CardHeader>
          <CardContent>
            <Typography variant="h5">{this.state.question}</Typography>
          </CardContent>
          <CardMedia>
            {" "}
            <canvas
              id={"result"}
              width={this.state.face_width}
              height={this.state.face_height}
            />
          </CardMedia>
          <CardActions>
            <Button
              variant="contained"
              color="primary"
              component={Link}
              to={"/"}
              onClick={() => {
                clearTimeout(this.settimeout);
              }}
            >
              End
            </Button>
          </CardActions>
        </Card>
      </Container>
    );
  }

  componentWillUnmount() {
    this.end();
    clearTimeout(this.settimeout);
  }
}

export default function App(props) {
  return (
    <WebcamCapture
      url={"/"}
      app={"biometrics"}
      view={"checkjson"}
      content={"check"}
      debug={props.debug}
      tablet={props.tablet}
    />
  );
}
